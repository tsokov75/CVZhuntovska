<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CVZhuntovska ‚Äì –î–µ—Ç—Å–∫–∏ –∫—É–∏–∑ –∑–∞ –ë—ä–ª–≥–∞—Ä–∏—è</title>
  <style>
    :root{
      --bg1:#fdfcfb; --bg2:#f9fafb; --accent:#0ea5e9; --accent2:#22c55e;
      --text:#1f2937; --muted:#6b7280; --btn:#ffffff; --btnHover:#f3f4f6;
      --green:#16a34a; --red:#dc2626; --shadow:0 10px 30px rgba(0,0,0,.08); --radius:18px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 500px at 0% -10%, #fff7ed 0%, transparent 60%),
        radial-gradient(1000px 500px at 100% 0%, #e0f2fe 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex; align-items:flex-start; justify-content:center; padding:24px; overflow-x:hidden;
    }
    /* –î–µ–∫–æ—Ä: —Å–ª—ä–Ω—Ü–µ + –±–∞–ª–æ–Ω–∏ */
    .sun{
      position: fixed; top: 24px; right: 24px; width: 90px; height:90px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff9c2, #fde047 60%, #f59e0b 100%);
      box-shadow: 0 0 40px rgba(245, 158, 11, .6);
      z-index: 0;
    }
    .balloon{
      position: fixed; bottom: -120px; width: 48px; height: 60px; border-radius: 50% 50% 45% 45%;
      background: var(--balloon-color, #60a5fa); left: var(--x, 10%);
      box-shadow: inset -8px -12px 20px rgba(0,0,0,.08);
      animation: floatUp var(--dur, 14s) linear infinite;
      z-index: 0;
    }
    .balloon:after{ /* –≤—Ä—ä–≤ */
      content:""; position:absolute; bottom:-22px; left:50%; width:2px; height:24px; background:#94a3b8; transform:translateX(-50%);
    }
    @keyframes floatUp {
      0% { transform: translateY(0) rotate(0deg); opacity: .9; }
      100% { transform: translateY(-120vh) rotate(4deg); opacity: .9; }
    }

    .app{ position:relative; z-index: 1; width:100%; max-width:900px; background:#ffffff;
      border:1px solid #eef2f7; border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
    .hero{ display:flex; align-items:center; gap:18px; padding:20px 22px;
      background: linear-gradient(180deg, #ffffff, #f8fafc); border-bottom:1px solid #eef2f7; }
    .flag{ width:88px; height:58px; flex:0 0 auto; border-radius:10px; overflow:hidden; box-shadow: 0 6px 16px rgba(0,0,0,.08); border:1px solid #e5e7eb; }
    .title{ display:flex; flex-direction:column; gap:4px; }
    .title h1{ margin:0; font-size: clamp(20px, 3vw, 26px); }
    .subtitle{ margin:0; color:var(--muted); font-size:14px; }
    .content{ padding: 10px 22px 22px; }
    .statusbar{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom: 14px; }
    .badge{ background:#e0f2fe; color:#0c4a6e; padding:6px 10px; border-radius:999px; font-weight:600; font-size:13px; border:1px solid #bae6fd; }
    .chip{ background:#f1f5f9; color:#334155; padding:6px 10px; border-radius:999px; font-size:13px; border:1px solid #e2e8f0; }
    .progress{ height:10px; width:100%; background:#eef2f7; border-radius:999px; overflow:hidden; }
    .progress>div{ height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .3s ease; }
    .spacer{ height: 10px; }
    .grid{
      display:grid; grid-template-columns: 5fr 3fr; gap:16px;
    }
    @media (max-width: 860px){ .grid{ grid-template-columns: 1fr; } }
    .card{ background:#ffffff; border:1px solid #eef2f7; border-radius:16px; padding:16px; box-shadow: var(--shadow); margin-top: 6px; }
    .question{ font-weight:800; font-size: clamp(18px, 2.2vw, 22px); line-height:1.35; margin: 10px 0 16px; }
    .answers{ display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width:700px){ .answers{ grid-template-columns: 1fr 1fr; } }
    .answer{
      border:1px solid #e5e7eb; background: var(--btn); padding:14px; border-radius:14px; cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      min-height:56px; text-align:left; display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .answer:hover{ background: var(--btnHover); }
    .answer:active{ transform: scale(0.99); }
    .answer.disabled{ cursor: default; opacity: .85; }
    .answer.correct{ border-color: rgba(22,163,74,0.6); background: rgba(34,197,94,0.09); box-shadow: inset 0 0 0 1px rgba(34,197,94,.25); }
    .answer.wrong{ border-color: rgba(220,38,38,0.6); background: rgba(248,113,113,0.10); box-shadow: inset 0 0 0 1px rgba(248,113,113,.25); }
    .meta{ display:flex; justify-content:space-between; align-items:center; margin-top: 12px; color:#374151; font-size:14px; }
    .footer{ display:flex; gap:10px; justify-content:space-between; margin-top:16px; }
    button{ border-radius:12px; padding:12px 14px; border:1px solid #e5e7eb; background:#ffffff; color:#111827; cursor:pointer; font-weight:700; }
    button.primary{ background: linear-gradient(180deg, #60a5fa, #3b82f6); color:white; border:none; }
    button.primary:hover{ filter: brightness(1.05); }
    button:active{ transform: scale(.99); }
    .hidden{ display:none !important; }
    .score{ font-size: 18px; background:#fff7ed; border:1px solid #fed7aa; color:#9a3412; padding:12px 14px; border-radius:12px; margin-top:10px; }

    /* –¢–∞–±–ª–æ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ */
    .board table{ width:100%; border-collapse: collapse; }
    .board th, .board td{ padding:8px 10px; border-bottom:1px solid #e5e7eb; text-align:left; }
    .board th{ background:#f8fafc; }
    .board .empty{ color:var(--muted); font-size:14px; padding:8px 0; }
  </style>
</head>
<body>
  <!-- –î–µ–∫–æ—Ä–∞—Ü–∏–∏ -->
  <div class="sun"></div>
  <div class="balloon" style="--x:8%; --balloon-color:#60a5fa; --dur:16s;"></div>
  <div class="balloon" style="--x:16%; --balloon-color:#34d399; --dur:18s;"></div>
  <div class="balloon" style="--x:28%; --balloon-color:#f472b6; --dur:20s;"></div>
  <div class="balloon" style="--x:72%; --balloon-color:#f59e0b; --dur:19s;"></div>
  <div class="balloon" style="--x:86%; --balloon-color:#a78bfa; --dur:17s;"></div>

  <main class="app" role="application" aria-label="–ö—É–∏–∑ ‚Äì –ë—ä–ª–≥–∞—Ä–∏—è –∑–∞ –¥–µ—Ü–∞">
    <div class="hero">
      <div class="flag" aria-hidden="true">
        <svg viewBox="0 0 3 2" width="100%" height="100%" preserveAspectRatio="xMidYMid slice">
          <rect width="3" height="2" fill="#ffffff"></rect>
          <rect y="0.6666" width="3" height="0.6666" fill="#00966E"></rect>
          <rect y="1.3333" width="3" height="0.6666" fill="#D62612"></rect>
        </svg>
      </div>
      <div class="title">
        <h1>üéà –ö—É–∏–∑ –∑–∞ –º–∞–ª–∫–∏ –æ—Ç–∫—Ä–∏–≤–∞—Ç–µ–ª–∏</h1>
        <p class="subtitle">–¢–æ—á–∫–∏ —Å–ø–æ—Ä–µ–¥ –≤—Ä–µ–º–µ: ‚â§5s = 3, ‚â§8s = 2, >10s = 1</p>
      </div>
    </div>

    <div class="content">
      <div class="statusbar">
        <div class="badge" id="badge">–í—ä–ø—Ä–æ—Å 1 –æ—Ç 3</div>
        <div class="chip">–ò–∑–±—Ä–∞–Ω–∏: <span id="pickedCount">0</span> / <span id="needCount">1</span></div>
        <div class="chip">–¢–æ—á–∫–∏: <span id="score">0</span></div>
        <div class="chip">‚è±Ô∏è –í—Ä–µ–º–µ: <span id="timer">0.0</span> s</div>
      </div>
      <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>
      <div class="spacer"></div>

      <div class="grid">
        <!-- –ö–ê–†–¢–ê –° –í–™–ü–†–û–°–ê -->
        <div class="card">
          <div class="question" id="questionText">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ‚Ä¶</div>
          <div class="answers" id="answers" role="group" aria-label="–í—ä–∑–º–æ–∂–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏"></div>
          <div class="meta">
            <div id="helpText" style="color:var(--muted)">–ú–∞—Ä–∫–∏—Ä–∞–π –≤–µ—Ä–Ω–∏—è –æ—Ç–≥–æ–≤–æ—Ä</div>
            <div></div>
          </div>
          <div class="footer">
            <button id="resetBtn" type="button">–†–µ—Å—Ç–∞—Ä—Ç (—Ä–∞–∑–±—ä—Ä–∫–∞–π)</button>
            <button id="nextBtn" class="primary hidden" type="button">–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
          </div>
          <div class="score hidden" id="finalBox"></div>
        </div>

        <!-- –¢–ê–ë–õ–û -->
        <div class="card board">
          <h3 style="margin:6px 0 10px">üèÜ –¢–∞–±–ª–æ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h3>
          <div id="boardContainer"></div>
          <div style="display:flex; gap:8px; margin-top:10px;">
            <button id="saveScoreBtn" class="primary" type="button">–ó–∞–ø–∏—à–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞</button>
            <button id="clearBoardBtn" type="button">–ò–∑—á–∏—Å—Ç–∏ —Ç–∞–±–ª–æ—Ç–æ</button>
          </div>
          <p style="margin-top:8px; color:var(--muted); font-size:13px;">–°—ä—Ö—Ä–∞–Ω—è–≤–∞ —Å–µ —Å–∞–º–æ –Ω–∞ —Ç–æ–∑–∏ –±—Ä–∞—É–∑—ä—Ä (Local Storage).</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // === –î–∞–Ω–Ω–∏ ===
    const BASE_QUESTIONS = [
      { q: "–° –∫–æ—è –æ—Ç –ø–æ—Å–æ—á–µ–Ω–∏—Ç–µ –¥—ä—Ä–∂–∞–≤–∏ –ë—ä–ª–≥–∞—Ä–∏—è –Ω–µ –≥—Ä–∞–Ω–∏—á–∏?",
        a: ["–ê: –†—É–º—ä–Ω–∏—è","–ë: –ô–æ—Ä–¥–∞–Ω–∏—è","–í: –¢—É—Ä—Ü–∏—è","–ì: –ì—ä—Ä—Ü–∏—è"], correct: [1] },
      { q: "–ö–æ—è –µ –ø–ª–∞–Ω–∏–Ω–∞—Ç–∞, –∫–æ—è—Ç–æ —Ä–∞–∑–¥–µ–ª—è –ë—ä–ª–≥–∞—Ä–∏—è –Ω–∞ –Æ–∂–Ω–∞ –∏ –°–µ–≤–µ—Ä–Ω–∞?",
        a: ["–ê: –°—Ç—Ä–∞–Ω–¥–∂–∞","–ë: –†–∏–ª–∞","–í: –°—Ç–∞—Ä–∞ –ø–ª–∞–Ω–∏–Ω–∞","–ì: –ü–ª–∞–Ω–∞"], correct: [2] },
      { q: "–ö–æ–π –≥—Ä–∞–¥ –µ —Å—Ç–æ–ª–∏—Ü–∞ –Ω–∞ –ë—ä–ª–≥–∞—Ä–∏—è –≤ –¥–Ω–µ—à–Ω–æ –≤—Ä–µ–º–µ?",
        a: ["–ê: –í–µ–ª–∏–∫–æ –¢—ä—Ä–Ω–æ–≤–æ","–ë: –°–æ—Ñ–∏—è","–í: –ü–ª–∏—Å–∫–∞","–ì: –ü—Ä–µ—Å–ª–∞–≤"], correct: [1] }
    ];

    let QUESTIONS = [];

    // DOM
    const questionText = document.getElementById('questionText');
    const answersEl = document.getElementById('answers');
    const badge = document.getElementById('badge');
    const progressBar = document.getElementById('progressBar');
    const pickedCountEl = document.getElementById('pickedCount');
    const needCountEl = document.getElementById('needCount');
    const scoreEl = document.getElementById('score');
    const nextBtn = document.getElementById('nextBtn');
    const resetBtn = document.getElementById('resetBtn');
    const finalBox = document.getElementById('finalBox');
    const timerEl = document.getElementById('timer');

    const boardContainer = document.getElementById('boardContainer');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const clearBoardBtn = document.getElementById('clearBoardBtn');

    // –°—ä—Å—Ç–æ—è–Ω–∏–µ
    let index = 0, score = 0, pickedCount = 0, locked = false;
    let selected = new Set();
    let startTime = 0;
    let timerTick = null;

    // –ê—É–¥–∏–æ (WebAudio API –∑–∞ –∫—Ä–∞—Ç–∫–æ "–ø–∏–Ω–≥" –ø—Ä–∏ –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä)
    let audioCtx = null;
    function playDing(){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = "triangle";
        o.frequency.setValueAtTime(880, audioCtx.currentTime);
        g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.35);
        o.connect(g).connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + 0.4);
      }catch(e){ /* ignore */ }
    }

    // –¢–∞–±–ª–æ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ (localStorage)
    const BOARD_KEY = "cvzhuntovska_board_v1";
    function loadBoard(){
      try{ return JSON.parse(localStorage.getItem(BOARD_KEY) || "[]"); }catch{ return []; }
    }
    function saveBoard(arr){ localStorage.setItem(BOARD_KEY, JSON.stringify(arr)); }
    function renderBoard(){
      const data = loadBoard().sort((a,b)=> b.score - a.score);
      if(data.length === 0){
        boardContainer.innerHTML = '<div class="empty">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.</div>';
        return;
      }
      const rows = data.map((r,i)=> `<tr><td>${i+1}</td><td>${escapeHtml(r.name)}</td><td>${r.score}</td><td>${new Date(r.time).toLocaleString()}</td></tr>`).join("");
      boardContainer.innerHTML = `<table><thead><tr><th>#</th><th>–ò–º–µ</th><th>–¢–æ—á–∫–∏</th><th>–í—Ä–µ–º–µ</th></tr></thead><tbody>${rows}</tbody></table>`;
    }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c])); }
    saveScoreBtn.addEventListener('click', ()=>{
      const name = prompt("–í—ä–≤–µ–¥–∏ –∏–º–µ –∑–∞ —Ç–∞–±–ª–æ—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ú–∞–≥–∏):") || "–î–µ—Ç–µ";
      const data = loadBoard();
      data.push({ name, score, time: Date.now() });
      // –ó–∞–ø–∞–∑–≤–∞–º–µ —Å–∞–º–æ —Ç–æ–ø 10
      data.sort((a,b)=> b.score - a.score);
      saveBoard(data.slice(0,10));
      renderBoard();
      alert("–ó–∞–ø–∏—Å–∞–Ω–æ! –í–∏–∂ —Ç–∞–±–ª–æ—Ç–æ –≤–¥—è—Å–Ω–æ.");
    });
    clearBoardBtn.addEventListener('click', ()=>{
      if(confirm("–°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏, —á–µ –∏—Å–∫–∞—à –¥–∞ –∏–∑—á–∏—Å—Ç–∏—à —Ç–∞–±–ª–æ—Ç–æ?")){
        saveBoard([]); renderBoard();
      }
    });

    // –ü–æ–º–æ—â–Ω–∏
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function deepCopy(obj){ return JSON.parse(JSON.stringify(obj)); }

    function resetDataShuffle(){
      QUESTIONS = deepCopy(BASE_QUESTIONS);
      shuffle(QUESTIONS); // —Ä–µ–¥ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ
      for(const q of QUESTIONS){
        const zipped = q.a.map((text,i)=>({text, idx:i, isCorrect:q.correct.includes(i)}));
        shuffle(zipped); // —Ä–µ–¥ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ
        q.a = zipped.map(z=>z.text);
        q.correct = zipped.map((z,i)=> z.isCorrect ? i : -1).filter(i=>i>=0);
      }
    }

    function updateProgress(){
      const step = ((index)/QUESTIONS.length)*100;
      progressBar.style.width = step + '%';
      badge.textContent = `–í—ä–ø—Ä–æ—Å ${Math.min(index+1,QUESTIONS.length)} –æ—Ç ${QUESTIONS.length}`;
    }

    function startQuestionTimer(){
      startTime = performance.now();
      timerEl.textContent = '0.0';
      if (timerTick) cancelAnimationFrame(timerTick);
      const loop = () => {
        const elapsed = (performance.now()-startTime)/1000;
        timerEl.textContent = elapsed.toFixed(1);
        timerTick = requestAnimationFrame(loop);
      };
      timerTick = requestAnimationFrame(loop);
    }
    function stopQuestionTimer(){ if (timerTick) cancelAnimationFrame(timerTick); }
    function currentElapsedSeconds(){ return (performance.now()-startTime)/1000; }

    function renderQuestion(){
      locked=false; pickedCount=0; selected.clear();
      pickedCountEl.textContent='0'; nextBtn.classList.add('hidden'); finalBox.classList.add('hidden');
      const q = QUESTIONS[index];
      questionText.textContent = q.q;
      needCountEl.textContent = String(q.correct.length);
      answersEl.innerHTML='';
      q.a.forEach((text,i)=>{
        const btn = document.createElement('button');
        btn.className='answer'; btn.type='button'; btn.dataset.idx=i;
        btn.innerHTML=`<span>${text}</span>`;
        btn.addEventListener('click',()=>handlePick(btn));
        answersEl.appendChild(btn);
      });
      updateProgress();
      startQuestionTimer();
    }

    function calcPoints(elapsedSec){
      if (elapsedSec <= 5) return 3;
      if (elapsedSec <= 8) return 2;
      return 1;
    }

    function handlePick(btn){
      if(locked || btn.classList.contains('disabled')) return;
      const q = QUESTIONS[index];
      const realIdx = parseInt(btn.dataset.idx,10);
      if(selected.has(realIdx)) return;
      selected.add(realIdx);

      pickedCount++; pickedCountEl.textContent=String(pickedCount);
      const isCorrect = q.correct.includes(realIdx);
      btn.classList.add('disabled', isCorrect ? 'correct' : 'wrong');

      if(isCorrect){
        document.querySelectorAll('.answer:not(.correct):not(.wrong)').forEach(b=> b.classList.add('disabled'));
        const pts = calcPoints(currentElapsedSeconds());
        score += pts; scoreEl.textContent = String(score);
        playDing(); // –∑–≤—É–∫ –ø—Ä–∏ –≤–µ—Ä–µ–Ω
        stopQuestionTimer();
        setTimeout(()=> nextBtn.classList.remove('hidden'), 400);
        locked = true;
      } else {
        // –≥—Ä–µ—à–µ–Ω –∏–∑–±–æ—Ä ‚Äì –º–∞—Ä–∫–∏—Ä–∞–º–µ –∏ –ø–æ–∑–≤–æ–ª—è–≤–∞–º–µ –Ω–æ–≤ –æ–ø–∏—Ç
      }
    }

    function nextQuestion(){
      if(index < QUESTIONS.length-1){ index++; renderQuestion(); }
      else {
        progressBar.style.width='100%'; badge.textContent='–ì–æ—Ç–æ–≤–æ!';
        answersEl.innerHTML=''; questionText.textContent='–†–µ–∑—É–ª—Ç–∞—Ç';
        finalBox.classList.remove('hidden');
        finalBox.innerHTML = `–°—ä–±—Ä–∞–Ω–∏ —Ç–æ—á–∫–∏: <strong>${score}</strong> (–º–∞–∫—Å. ${QUESTIONS.length*3}).`;
        nextBtn.classList.add('hidden');
      }
    }

    nextBtn.addEventListener('click', nextQuestion);
    resetBtn.addEventListener('click', ()=>{ index=0; score=0; scoreEl.textContent='0'; resetDataShuffle(); renderQuestion(); });

    // –°—Ç–∞—Ä—Ç
    resetDataShuffle();
    renderQuestion();
    renderBoard();
  </script>
</body>
</html>
